const M=async m=>{if(typeof google_places_wp>"u"){console.warn("You need to configure your map settings in the Google WP Places admin settings area.");return}else if(typeof google_places_wp.mapdata.coords.lat>"u"){console.warn("You need to configure your map settings in the Google WP Places admin settings area.");return}if(typeof m>"u"){console.warn("jQuery conflict error! Google Places WP couldn't properly load or find jQuery on the page.");return}if(typeof google>"u"){console.warn("Error loading Google Maps JS, is your API key set properly?");return}let s,i,c=[],g=google_places_wp.mapdata.places;m(document).ready(async p=>{const{Map:_,InfoWindow:h}=await google.maps.importLibrary("maps"),{AdvancedMarkerElement:u}=await google.maps.importLibrary("marker"),{LatLngBounds:k}=await google.maps.importLibrary("core");let f={lat:google_places_wp.mapdata.coords.lat,lng:google_places_wp.mapdata.coords.lng},P=document.getElementById("google-places-wp-map"),b=13;s=new _(P,{center:f,mapId:"DEMO_MAP_ID",zoom:b}),i=new h({disableAutoPan:!0});const v=new k,L=new u({map:s,position:f,zIndex:4});google.maps.event.addListener(L,"click",()=>{let e=`<div class="google-places-wp-info-window"><span class="google-places-wp-iw-title">${google_places_wp.mapdata.location_name}</span><br/><br><span>${google_places_wp.mapdata.street_address}<br>${google_places_wp.mapdata.city}</span><br><a href="${google_places_wp.mapdata.map_url}" target="_blank">Get Directions &raquo;</a></div>`;i.setContent(e),i.open(s,void 0)}),p(".map-controller button").map((e,t)=>{let n=p(t).data("place-type"),l=[];for(const o of Object.keys(google_places_wp.mapdata.places))g[o].types==n&&l.push(g[o]);let a=document.createElement("span");a.innerHTML=` (${l.length})`,a.className="gp-wp-place-type-total",t.append(a)});function y(e,t,n,l){const a=Math.pow(2,e.getZoom()),o=e.getProjection().fromLatLngToPoint(t),d=new google.maps.Point(n/a||0,l/a||0),w=new google.maps.Point(o.x+d.x,o.y-d.y),r=e.getProjection().fromPointToLatLng(w);e.panTo(r)}const T=e=>{if(!e)return;let t={lat:parseFloat(e.lat),lng:parseFloat(e.lng)},n=new u({map:s,position:t,title:e.name});return c.push(n),google.maps.event.addListener(n,"click",function(){let l=`<div class="google-places-wp-infowindow"><p class="google-places-wp-iw-title">${e.name}</p><div class="google-places-wp-iw-photo" style="height: 115px; width: 20vw; max-width: 100%; background: url('${e.photo}') top center no-repeat; background-size: cover;"></div><p class="google-places-wp-iw-address">${e.pretty_address}</p><div class="google-places-wp-iw-links"><a href="${e.url}" target="_blank">View Website</a><br/><a href="https://www.google.com/maps?q=place_id:${e.location_id}" target="_blank">Get Directions &raquo;</a></div></div>`;i.setContent(l),i.open(s,this),y(s,t,0,160)}),n.setMap(s),n},C=(e,t,n)=>{if(!e.length)return;if(c.length)for(let o=0;o<c.length;o++)c[o].setMap(null);c=[];let l=t.next(),a=[];e.map(o=>{let d=T(o);n.extend({lat:parseFloat(o.lat),lng:parseFloat(o.lng)});let w=document.createElement("p"),r=document.createElement("a");r.setAttribute("data-place-id",o.location_id),r.innerHTML=o.name,w.appendChild(r),r.addEventListener("click",()=>{y(s,{lat:parseFloat(o.lat),lng:parseFloat(o.lng)},0,-180),google.maps.event.trigger(d,"click")}),a.push(w)}),s.fitBounds(n),l.append(a),l.slideDown()};p(".map-controller button").on("click",async e=>{let t=p(e.currentTarget);if(t.hasClass("google-places-wp-is-open"))return;p(".map-controller button").removeClass("google-places-wp-is-open"),t.addClass("google-places-wp-is-open");let n=t.data("place-type"),l=[];await new Promise(a=>p(".google-wp-places-places-listed").slideUp("fast",a)).then(()=>{p(".google-wp-places-places-listed").empty();for(const a of Object.keys(google_places_wp.mapdata.places))g[a].types==n&&l.push(g[a]);C(l,t,v)})})})};M(jQuery);
